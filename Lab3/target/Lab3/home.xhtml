<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Lab3 Bulko Egor</title>
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com"/>
        <link href="https://fonts.googleapis.com/css2?family=Amaranth:ital@0;1&amp;family=Montserrat:wght@600&amp;display=swap" rel="stylesheet"/>

        <meta http-equiv="Content-Type" content="text/html" />
        <link rel="stylesheet" href="src/css/style.css"/>
    </h:head>
    <h:body>
        <ui:include src="header.xhtml" />

        <div class="content convex row">
            <div class="areas">
                <canvas id="areas_canvas" height="300" width="300"></canvas>
            </div>
            <h:form id="canvas_form">
                <h:inputHidden id="canvas_x" value="#{canvasBean.x}" />
                <h:inputHidden id="canvas_y" value="#{canvasBean.y}" />
                <p:remoteCommand name="canvas_shot" update="canvas_x canvas_y result_table input_form"
                                 action="#{userDataBean.newShot(canvasBean.x,
                                        canvasBean.y, rBean.r)}"/>
            </h:form>
            <div id="form_div">
                <h:form id="input_form">
                    <div class="input convex">
                        <div class="input_text" style="margin-bottom: 10px;">Select X:</div>
                        <h:selectOneRadio value = "#{xBean.x}">
                            <f:selectItem id="x_m3" itemValue = "-3" itemLabel = "-3" />
                            <f:selectItem id="x_m2" itemValue = "-2" itemLabel = "-2" />
                            <f:selectItem id="x_m1" itemValue = "-1" itemLabel = "-1" />
                            <f:selectItem id="x_0" itemValue = "0" itemLabel = "0" />
                            <f:selectItem id="x_1" itemValue = "1" itemLabel = "1" />
                            <f:selectItem id="x_2" itemValue = "2" itemLabel = "2" />
                            <f:selectItem id="x_3" itemValue = "3" itemLabel = "3" />
                            <f:selectItem id="x_4" itemValue = "4" itemLabel = "4" />
                            <f:selectItem id="x_5" itemValue = "5" itemLabel = "5" />
                        </h:selectOneRadio>
                    </div>
                    <div class="input convex row">
                        <div class="input_text" style="margin-bottom: 10px;">Enter Y:</div>
                        <h:inputText id="y" class="concave" required="true" value="${yBean.y}" validator="${yBean.validateY}" a:placeholder="-3 ... 5">
                            <f:validateLongRange minimum="-3" maximum="5" />
                            <f:ajax execute="y-select" render="@form" />
                        </h:inputText>
                    </div>
                    <div class="input convex" style="display: block">
                        <div class="row" style="margin-bottom: 20px;">
                            <div class="input_text">Choose R:</div>
                            <label id="input_label" style="display: none">${rBean.r}</label>
                        </div>
                        <div class="buttons" id="r_select">
                            <h:selectBooleanCheckbox id="r_b1" value="${rBean.b1}" validator="${rBean.validateR}" onclick="setInputLabelValue(1)">
                                <f:ajax render="r_b1 r_b15 r_b2 r_b25 r_b3 draw_script" />
                            </h:selectBooleanCheckbox> 1
                            <h:selectBooleanCheckbox id="r_b15" value="${rBean.b15}" validator="${rBean.validateR}" onclick="setInputLabelValue(1.5)">
                                <f:ajax render="r_b1 r_b15 r_b2 r_b25 r_b3 draw_script" />
                            </h:selectBooleanCheckbox> 1.5
                            <h:selectBooleanCheckbox id="r_b2" value="${rBean.b2}" validator="${rBean.validateR}" onclick="setInputLabelValue(2)">
                                <f:ajax render="r_b1 r_b15 r_b2 r_b25 r_b3 draw_script" />
                            </h:selectBooleanCheckbox> 2
                            <h:selectBooleanCheckbox id="r_b25" value="${rBean.b25}" validator="${rBean.validateR}" onclick="setInputLabelValue(2.5)">
                                <f:ajax render="r_b1 r_b15 r_b2 r_b25 r_b3 draw_script" />
                            </h:selectBooleanCheckbox> 2.5
                            <h:selectBooleanCheckbox id="r_b3" value="${rBean.b3}" validator="${rBean.validateR}" onclick="setInputLabelValue(3)">
                                <f:ajax render="r_b1 r_b15 r_b2 r_b25 r_b3 draw_script" />
                                <f:validateRequired />
                            </h:selectBooleanCheckbox> 3
                        </div>
                    </div>
                    <div id="submit_row" class="row">
                        <h:commandButton class="convex" id="submit_button" value="Submit">
                            <f:ajax execute="@form" listener="#{userDataBean.newShot(xBean.x,
                                        yBean.y, rBean.r)}" update="draw_script" render="result_table draw_script"/>
                        </h:commandButton>
                        <div style="display: none;" id="tip"></div>
                    </div>
                </h:form>
            </div>
        </div>

        <div class="convex" id="results">
            <h:dataTable id="result_table" class="results" value="#{userDataBean.shots}" var="s" style="text-align: center;">
                <h:column pt:style="width:10%">
                    <f:facet name = "header">X</f:facet>
                    #{s.x}
                </h:column>
                <h:column pt:style="width:10%">
                    <f:facet name = "header">Y</f:facet>
                    #{s.y}
                </h:column>
                <h:column pt:style="width:10%">
                    <f:facet name = "header">R</f:facet>
                    #{s.r}
                </h:column>
                <h:column pt:style="width:10%">
                    <f:facet name = "header">HitFact</f:facet>
                    #{s.hit ? "Hit" : "Miss"}
                </h:column>
                <h:column pt:style="width:33%">
                    <f:facet name = "header">Executed at</f:facet>
                    <h:outputText converter="timeConverter" value="#{s.currTime}" />
                </h:column>
                <h:column pt:style="width:27%">
                    <f:facet name = "header">Execution time</f:facet>
                    #{s.execTime}
                </h:column>
            </h:dataTable>
            <div>
                <h:commandButton id="clear" class="convex" value="Clear">
                    <f:ajax execute="@form" listener="#{userDataBean.clearShots()}" update="draw_script" render="result_table draw_script"/>
                </h:commandButton>
            </div>
        </div>
        <script src="src/js/jquery.js"></script>
        <script src="src/js/script.js"></script>
        <script src="src/js/points.js"></script>
        <script id="draw_script">
            function drawAllPoints() {
            <ui:repeat id="draw_functions" value="#{userDataBean.shots}" var="s">drawPointXYCoords(#{s.x}, #{s.y}, ${s.r}, ${s.hit});
            </ui:repeat>
            }
        </script>
        <script>
            drawAllPoints();
        </script>
    </h:body>
</html>